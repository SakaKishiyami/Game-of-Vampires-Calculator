---
title: "STA 431/531 Homework 1"
author: "Your Name"
date: "2025-09-10"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## 1. Descriptive computations without using mean/sd/cor

Original prompt:

- Given dataset (X, Y). Use R to calculate, without using built-ins `mean`, `sd`, `cor` or `lm`:
  - (a) Sample mean of Y
  - (b) Sample standard deviation of Y
  - (c) Correlation coefficient between X and Y

Data:

```{r q1-data}
X <- c(44.0, 41.8, 42.6, 33.2, 56.2, 53.7, 34.0, 34.3, 39.0, 58.8, 47.3, 30.0, 47.8, 52.6, 29.1)
Y <- c(13.2, 17.7, 16.4, 9.7, 13.8, 18.8, 19.6, 11.3, 21.8, 15.7, 11.1, 12.6, 12.0, 14.1, 10.7)
stopifnot(length(X) == length(Y))
n <- length(Y)
```

(a) Sample mean of Y:

```{r q1a-mean}
# mean(Y) = sum(Y) / n
sumY <- sum(Y)
Y_bar <- sumY / n
Y_bar
```

(b) Sample standard deviation of Y:

```{r q1b-sd}
# Sample variance: s^2 = sum((Y - Y_bar)^2) / (n - 1)
# Sample sd: sqrt(s^2)
Y_dev <- Y - Y_bar
SSY <- sum(Y_dev^2)
Y_var <- SSY / (n - 1)
Y_sd <- sqrt(Y_var)
Y_sd
```

(c) Correlation coefficient between X and Y:

```{r q1c-cor}
# r = S_xy / sqrt(S_xx * S_yy), where
# S_xy = sum((X - X_bar)*(Y - Y_bar)), S_xx = sum((X - X_bar)^2), S_yy = sum((Y - Y_bar)^2)
X_bar <- sum(X) / n
X_dev <- X - X_bar
S_xy <- sum(X_dev * Y_dev)
S_xx <- sum(X_dev^2)
S_yy <- SSY
r_xy <- S_xy / sqrt(S_xx * S_yy)
r_xy
```

(Quick check with built-ins â€“ not part of required solution):

```{r q1-check, echo=FALSE}
list(meanY_builtin = mean(Y), sdY_builtin = sd(Y), cor_builtin = cor(X, Y))
```

## 2. Tennis data frame operations

Original prompt:

- Read `tennis.txt` (skip explanatory lines) into data frame `tennis.dfr` with columns:
  `frst.name, last.name, major.match.wins, major.match.losses, overall.match.wins, overall.match.losses, major.titles, overall.titles`.
- Add columns `major.winning.pct` and `overall.winning.pct`.
- (c) Sort by `major.titles` (desc) and print.
- (d) Nested sort by `major.titles` (desc), then `major.winning.pct` (desc) and print.
- (e) Subset players with at least 6 major titles to `greatest.dfr` and print.
- (f) In the most efficient way, compute sample means for each numeric variable.

Note: Place `tennis.txt` in the working directory. The reader below auto-detects where the real data begins by finding the first line that yields 8 fields with 6 numeric fields in positions 3:8.

```{r q2-read}
read_tennis_data <- function(path) {
  lines <- readLines(path, warn = FALSE)
  # Find first data line: 8 whitespace-separated fields; fields 3:8 numeric
  is_data_line <- function(line) {
    if (grepl("^\\s*$", line)) return(FALSE)
    parts <- strsplit(trimws(line), "\\s+")[[1]]
    if (length(parts) != 8) return(FALSE)
    nums <- suppressWarnings(as.numeric(parts[3:8]))
    all(!is.na(nums))
  }
  start_idx <- which(vapply(lines, is_data_line, logical(1)))[1]
  if (is.na(start_idx)) stop("Could not detect start of data in tennis.txt")
  # Read from detected start using read.table for robustness
  con <- textConnection(paste(lines[start_idx:length(lines)], collapse = "\n"))
  on.exit(close(con), add = TRUE)
  df <- read.table(con, header = FALSE, stringsAsFactors = FALSE)
  names(df) <- c(
    "frst.name", "last.name",
    "major.match.wins", "major.match.losses",
    "overall.match.wins", "overall.match.losses",
    "major.titles", "overall.titles"
  )
  df
}

# Update path to your actual tennis.txt location if different
tennis_path <- "tennis.txt"
# If file is not found, skip execution gracefully
if (file.exists(tennis_path)) {
  tennis.dfr <- read_tennis_data(tennis_path)
} else {
  tennis.dfr <- NULL
  message("tennis.txt not found in working directory; skipping data load.")
}
```

Add winning percentage columns:

```{r q2-add-cols, eval=!!file.exists("tennis.txt")}
stopifnot(!is.null(tennis.dfr))
with(tennis.dfr, {
  major_total <- major.match.wins + major.match.losses
  overall_total <- overall.match.wins + overall.match.losses
})

tennis.dfr$major.winning.pct <- with(tennis.dfr, major.match.wins / (major.match.wins + major.match.losses))
tennis.dfr$overall.winning.pct <- with(tennis.dfr, overall.match.wins / (overall.match.wins + overall.match.losses))

head(tennis.dfr)
```

(c) Sort by major titles (descending):

```{r q2c-sort, eval=!!file.exists("tennis.txt")}
ord1 <- order(-tennis.dfr$major.titles)
sorted_major <- tennis.dfr[ord1, ]
sorted_major
```

(d) Nested sort: major titles (desc), then major winning pct (desc):

```{r q2d-nested-sort, eval=!!file.exists("tennis.txt")}
ord2 <- order(-tennis.dfr$major.titles, -tennis.dfr$major.winning.pct)
sorted_nested <- tennis.dfr[ord2, ]
sorted_nested
```

(e) Subset to players with at least 6 major titles:

```{r q2e-subset, eval=!!file.exists("tennis.txt")}
greatest.dfr <- subset(tennis.dfr, major.titles >= 6)
greatest.dfr
```

(f) Sample means for each numeric variable in `tennis.dfr`:

```{r q2f-means, eval=!!file.exists("tennis.txt")}
num_vars <- vapply(tennis.dfr, is.numeric, logical(1))
colMeans(tennis.dfr[, num_vars, drop = FALSE])
```

## 3. Write `tennis.dfr` to external file

Original prompt:

- Use `write.table()` to write `tennis.dfr` to an external file including column names, and ensure players' names are not surrounded by quotes.

```{r q3-write, eval=!!file.exists("tennis.txt")}
output_path <- "tennis_out.txt"
write.table(
  tennis.dfr,
  file = output_path,
  quote = FALSE,          # do not quote character fields
  row.names = FALSE,
  col.names = TRUE,
  sep = "\t"
)
output_path
```

## 4. Optional (STA 431): Fibonacci numbers

Original prompt:

- Compute the n-th Fibonacci number using (a) a for loop, (b) a while loop. Print the 15th from each.

```{r q4-fib}
fib_for <- function(n) {
  if (n <= 0) return(0)
  if (n <= 2) return(1)
  prev2 <- 1L  # F1
  prev1 <- 1L  # F2
  for (k in 3:n) {
    current <- prev1 + prev2
    prev2 <- prev1
    prev1 <- current
  }
  prev1
}

fib_while <- function(n) {
  if (n <= 0) return(0)
  if (n <= 2) return(1)
  prev2 <- 1L
  prev1 <- 1L
  k <- 3L
  while (k <= n) {
    current <- prev1 + prev2
    prev2 <- prev1
    prev1 <- current
    k <- k + 1L
  }
  prev1
}

list(F15_for = fib_for(15), F15_while = fib_while(15))
```

### Session info

```{r session-info}
sessionInfo()
```